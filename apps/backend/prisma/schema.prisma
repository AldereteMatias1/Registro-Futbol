generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Equipo {
  A
  B
}

enum EstadoParticipacion {
  ANOTADO
  JUGO
  BAJA
}

enum GanadorResultado {
  A
  B
  EMPATE
}

model Jugador {
  id             String           @id @default(uuid()) @db.Uuid
  apellidoNombre String           @db.VarChar(80)
  activo         Boolean          @default(true)
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime         @updatedAt @db.Timestamptz(6)
  participaciones Participacion[]
  goles          Gol[]

  @@index([activo], map: "idx_jugadores_activo")
}

model Partido {
  id             String           @id @default(uuid()) @db.Uuid
  fecha          DateTime         @db.Timestamptz(6)
  cancha         String?          @db.VarChar(80)
  notas          String?          @db.Text
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime         @updatedAt @db.Timestamptz(6)
  participaciones Participacion[]
  goles          Gol[]
  resultado      Resultado?

  @@index([fecha], map: "idx_partidos_fecha")
}

model Participacion {
  id          String               @id @default(uuid()) @db.Uuid
  partidoId   String               @db.Uuid
  jugadorId   String               @db.Uuid
  equipo      Equipo?
  estado      EstadoParticipacion
  motivoBaja  String?              @db.VarChar(120)
  comentarios String?              @db.Text
  createdAt   DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime             @updatedAt @db.Timestamptz(6)

  partido     Partido              @relation(fields: [partidoId], references: [id], onDelete: Cascade)
  jugador     Jugador              @relation(fields: [jugadorId], references: [id], onDelete: Cascade)

  @@unique([partidoId, jugadorId], map: "uniq_participacion_partido_jugador")
  @@index([partidoId], map: "idx_participaciones_partido")
  @@index([jugadorId], map: "idx_participaciones_jugador")
  @@index([estado], map: "idx_participaciones_estado")
}

model Gol {
  id        String   @id @default(uuid()) @db.Uuid
  partidoId String   @db.Uuid
  jugadorId String   @db.Uuid
  goles     Int
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)

  partido   Partido  @relation(fields: [partidoId], references: [id], onDelete: Cascade)
  jugador   Jugador  @relation(fields: [jugadorId], references: [id], onDelete: Cascade)

  @@unique([partidoId, jugadorId], map: "uniq_goles_partido_jugador")
  @@index([partidoId], map: "idx_goles_partido")
  @@index([jugadorId], map: "idx_goles_jugador")
}

model Resultado {
  id        String          @id @default(uuid()) @db.Uuid
  partidoId String          @unique @db.Uuid
  golesA    Int
  golesB    Int
  ganador   GanadorResultado
  createdAt DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt DateTime        @updatedAt @db.Timestamptz(6)

  partido   Partido         @relation(fields: [partidoId], references: [id], onDelete: Cascade)

  @@index([partidoId], map: "idx_resultados_partido")
}
