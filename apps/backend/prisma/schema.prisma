generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Jugador {
  id              String          @id @default(uuid()) @db.Uuid
  apellidoNombre  String          @db.VarChar(80)
  activo          Boolean         @default(true)
  createdAt       DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime        @updatedAt @db.Timestamptz(6)
  goles           Gol[]
  participaciones Participacion[]

  @@index([activo], map: "idx_jugadores_activo")
}

model Partido {
  id              String          @id @default(uuid()) @db.Uuid
  fecha           DateTime        @db.Timestamptz(6)
  cancha          String?         @db.VarChar(80)
  notas           String?
  createdAt       DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime        @updatedAt @db.Timestamptz(6)
  goles           Gol[]
  participaciones Participacion[]
  resultado       Resultado?

  @@index([fecha], map: "idx_partidos_fecha")
}

model Participacion {
  id          String              @id @default(uuid()) @db.Uuid
  partidoId   String              @db.Uuid
  jugadorId   String              @db.Uuid
  equipo      Equipo?
  estado      EstadoParticipacion
  motivoBaja  String?             @db.VarChar(120)
  comentarios String?
  createdAt   DateTime            @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime            @updatedAt @db.Timestamptz(6)
  jugador     Jugador             @relation(fields: [jugadorId], references: [id], onDelete: Cascade)
  partido     Partido             @relation(fields: [partidoId], references: [id], onDelete: Cascade)

  @@unique([partidoId, jugadorId], map: "uniq_participacion_partido_jugador")
  @@index([partidoId], map: "idx_participaciones_partido")
  @@index([jugadorId], map: "idx_participaciones_jugador")
  @@index([estado], map: "idx_participaciones_estado")
}

model Gol {
  id        String   @id @default(uuid()) @db.Uuid
  partidoId String   @db.Uuid
  jugadorId String   @db.Uuid
  goles     Int
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)
  jugador   Jugador  @relation(fields: [jugadorId], references: [id], onDelete: Cascade)
  partido   Partido  @relation(fields: [partidoId], references: [id], onDelete: Cascade)

  @@unique([partidoId, jugadorId], map: "uniq_goles_partido_jugador")
  @@index([partidoId], map: "idx_goles_partido")
  @@index([jugadorId], map: "idx_goles_jugador")
}

model Resultado {
  id        String           @id @default(uuid()) @db.Uuid
  partidoId String           @unique @db.Uuid
  golesA    Int
  golesB    Int
  ganador   GanadorResultado
  createdAt DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt DateTime         @updatedAt @db.Timestamptz(6)
  partido   Partido          @relation(fields: [partidoId], references: [id], onDelete: Cascade)

  @@index([partidoId], map: "idx_resultados_partido")
}

enum Equipo {
  A
  B
}

enum EstadoParticipacion {
  ANOTADO
  JUGO
  BAJA
}

enum GanadorResultado {
  A
  B
  EMPATE
}
